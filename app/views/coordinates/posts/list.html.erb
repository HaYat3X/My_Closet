<div id="closet_posts">
    <div class="d-flex">
        <%# ! sidebar %>
        <div class="side-content">
            <%= render "layouts/pc_sidebar" %>
        </div>

        <%# ! contents %>
        <div class="main-content">
            <div class="list-content mx-auto">
                <%# * タブ切り替え %>
                <ul class="tab-menu nav nav-underline nav-fill">
                    <li class="nav-item flex-fill">
                        <a href="?tab=all" class="nav-link fw-bold <%= params[:tab].nil? || params[:tab] == 'all' ? 'active' : '' %>">ALL</a>
                    </li>

                    <li class="nav-item flex-fill">
                        <a href="?tab=outer" class="nav-link fw-bold <%= params[:tab] == 'outer' ? 'active' : '' %>">OUTER</a>
                    </li>

                    <li class="nav-item flex-fill">
                        <a href="?tab=tops" class="nav-link fw-bold <%= params[:tab] == 'tops' ? 'active' : '' %>">TOPS</a>
                    </li>

                    <li class="nav-item flex-fill">
                        <a href="?tab=bottoms" class="nav-link fw-bold <%= params[:tab] == 'bottoms' ? 'active' : '' %>">BOTTOMS</a>
                    </li>

                    <li class="nav-item flex-fill">
                        <a href="?tab=shoes" class="nav-link fw-bold <%= params[:tab] == 'shoes' ? 'active' : '' %>">SHOES</a>
                    </li>

                    <li class="nav-item flex-fill">
                        <a href="?tab=other" class="nav-link fw-bold <%= params[:tab] == 'other' ? 'active' : '' %>">OTHER</a>
                    </li>
                </ul>

                <div class="tab-content">
                    <%# ? allタブエリア %>
                    <div id="all" class="tab-pane active">
                        <div class="row g-1">
                            <% if @closets_all.count == 0 %>
                                <h4 class="fw-bold text-center mt-5">アイテムがまだ登録されていません。</h4>
                            <% else %>
                                <% @closets_all.each do |c| %>
                                    <div class="col-lg-3 mt-1">
                                        <%= link_to "/closet/show/#{c.id}" do %>
                                            <%= image_tag c.photograph.url, class: "closet-image" %>
                                        <% end %>
                                    </div>
                                <% end %>
                                
                                <div class="page d-flex justify-content-center">
                                    <%= paginate @closets_all, param_name: :page_all, params: { tab: "all" } %>
                                </div>
                            <% end %>
                        </div>
                    </div>

                    <%# ? outerタブエリア %>
                    <div id="outer" class="tab-pane">
                        <div class="row g-1">
                            <% if @closets_outer.count == 0 %>
                                <h4 class="fw-bold text-center mt-5">アウターアイテムがまだ登録されていません。</h4>
                            <% else %>
                                <% @closets_outer.each do |c| %>
                                    <div class="col-lg-3 mt-1">
                                        <%= link_to "/closet/show/#{c.id}" do %>
                                            <%= image_tag c.photograph.url, class: "closet-image" %>
                                        <% end %>
                                    </div>
                                <% end %>

                                <div class="page d-flex justify-content-center">
                                    <%= paginate @closets_outer, param_name: :page_outer, params: { tab: "outer" } %>
                                </div>
                            <% end %>
                        </div>
                    </div>

                    <%# ? topsタブエリア %>
                    <div id="tops" class="tab-pane">
                        <div class="row g-1">
                            <% if @closets_tops.count == 0 %>
                                <h4 class="fw-bold text-center mt-5">トップスアイテムがまだ登録されていません。</h4>
                            <% else %>
                                <% @closets_tops.each do |c| %>
                                    <div class="col-lg-3 mt-1">
                                        <%= link_to "/closet/show/#{c.id}" do %>
                                            <%= image_tag c.photograph.url, class: "closet-image" %>
                                        <% end %>
                                    </div>
                                <% end %>

                                <div class="page d-flex justify-content-center">
                                    <%= paginate @closets_tops, param_name: :page_tops, params: { tab: "tops" } %>
                                </div>
                            <% end %>
                        </div>
                    </div>

                    <%# ? ボトムスタブエリア %>
                    <div id="bottoms" class="tab-pane">
                        <div class="row g-1">
                            <% if @closets_bottoms.count == 0 %>
                                <h4 class="fw-bold text-center mt-5">ボトムスアイテムがまだ登録されていません。</h4>
                            <% else %>
                                <% @closets_bottoms.each do |c| %>
                                    <div class="col-lg-3 mt-1">
                                        <%= link_to "/closet/show/#{c.id}" do %>
                                            <%= image_tag c.photograph.url, class: "closet-image" %>
                                        <% end %>
                                    </div>
                                <% end %>

                                <div class="page d-flex justify-content-center">
                                    <%= paginate @closets_bottoms, param_name: :page_bottoms, params: { tab: "bottoms" } %>
                                </div>
                            <% end %>
                        </div>
                    </div>

                    <%# ? shoesタブエリア %>
                    <div id="shoes" class="tab-pane">
                        <div class="row g-1">
                            <% if @closets_shoes.count == 0 %>
                                <h4 class="fw-bold text-center mt-5">シューズアイテムがまだ登録されていません。</h4>
                            <% else %>
                                <% @closets_shoes.each do |c| %>
                                    <div class="col-lg-3 mt-1">
                                        <%= link_to "/closet/show/#{c.id}" do %>
                                            <%= image_tag c.photograph.url, class: "closet-image" %>
                                        <% end %>
                                    </div>
                                <% end %>

                                <div class="page d-flex justify-content-center">
                                    <%= paginate @closets_shoes, param_name: :page_shoes, params: { tab: "shoes" } %>
                                </div>
                            <% end %>
                        </div>
                    </div>

                    <%# ? otherタブエリア %>
                    <div id="other" class="tab-pane">
                        <div class="row g-1">
                            <% if @closets_other.count == 0 %>
                                <h4 class="fw-bold text-center mt-5">その他のアイテムがまだ登録されていません。</h4>
                            <% else %>
                                <% @closets_other.each do |c| %>
                                    <div class="col-lg-3 mt-1">
                                        <%= link_to "/closet/show/#{c.id}" do %>
                                            <%= image_tag c.photograph.url, class: "closet-image" %>
                                        <% end %>
                                    </div>
                                <% end %>

                                <div class="page d-flex justify-content-center">
                                    <%= paginate @closets_other, param_name: :page_other, params: { tab: "other" } %>
                                </div>
                            <% end %>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function() { 
        <%# ! 現在位置しているタブをアクティブ状態にする %>
        function setActiveTab(tabId) {
            $('.tab-menu .nav-link').removeClass('active');
            $('.tab-content .tab-pane').removeClass('show active');
            $('#' + tabId).addClass('show active');
            $('.tab-menu .nav-link[href*="tab=' + tabId + '"]').addClass('active');
        }

        const urlParams = new URLSearchParams(window.location.search);
        const tabValue = urlParams.get('tab');

        if (tabValue) {
            const tabId = tabValue.toLowerCase();
            setActiveTab(tabId);
        } else {
            $('.tab-menu .nav-link[href*="?tab=all"]').addClass('active');
            $('.tab-content .tab-pane#all').addClass('show active');
        }

        <%# ! ページ遷移時にタブの位置を保持する %>
        $(document).on('click', '.tab-menu .nav-link', function(event) {
            event.preventDefault();
            const tabId = $(this).attr('href').split('tab=')[1].toLowerCase();

            if (tabId === 'page') {
                return;
            }

            setActiveTab(tabId);

            const newUrl = window.location.pathname + '?tab=' + tabId;
            window.history.pushState({ path: newUrl }, '', newUrl);
        });
    });
</script>