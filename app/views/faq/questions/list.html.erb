<div id="faq_questions">
    <div class="d-flex">
        <%# ! sidebar %>
        <div class="side-content">
            <%= render "layouts/pc_sidebar" %>
        </div>

        <%# ! contents %>
        <div class="main-content">
            <div class="list-content mx-auto">
                <ul class="tab-menu nav nav-underline nav-fill" role="tablist">
                    <li class="nav-item flex-fill">
                        <a href="?tab=all" class="nav-link fw-bold <%= params[:tab].nil? || params[:tab] == 'all' ? 'active' : '' %>">ALL</a>
                    </li>

                    <li class="nav-item flex-fill">
                        <a href="?page=1&tab=men" class="nav-link fw-bold <%= params[:tab] == 'men' ? 'active' : '' %>">MEN</a>
                    </li>

                    <li class="nav-item flex-fill">
                        <a href="?page=1&tab=women" class="nav-link fw-bold <%= params[:tab] == 'women' ? 'active' : '' %>">WOMEN</a>
                    </li>
                </ul>

                <div class="tab-content mt-2">
                    <%# ? allエリア %>
                    <div id="all" class="tab-pane active">
                        <div class="row question-area">
                            <% @questions_all.each do |question| %>
                                <div class="col-lg-6 mt-4">
                                    <div class="d-flex">
                                        <%= image_tag question.photograph.url, class: "question_image" %>

                                        <div class="question-area">
                                            <div class="d-flex align-items-center user-area">
                                                <%= link_to "/profile/show/#{question.user.id}" do %>
                                                    <% if question.user.avatar.url %>
                                                        <%= image_tag question.user.avatar.url, class: "question-user-image" %>
                                                    <% else %>
                                                        <img src="/assets/user/avatar.png" alt="Generic placeholder image" class="question-user-image">
                                                    <% end %>
                                                <% end %>

                                                <div class="user-information">
                                                    <h5 class="mb-0 fw-bold"><%= question.user.user_name %></h5>
                                                    <small><%= question.created_at.strftime('%m月%d日') %></small>
                                                </div>
                                            </div>

                                            <div class="question-information">
                                                <%= truncate(question.question, length: 44) %>
                                            </div>

                                            <div class="answer d-flex align-items-center justify-content-end">
                                                <%= link_to "/question/show/#{question.id}", style: "text-decoration: none; display: flex; align-items: center; margin-right: 2px;" do %>
                                                    <img src="/assets/icons/icn_message_b.png" alt="">
                                                <% end %>

                                                <small class="m-0">
                                                    <%= Answer.where(question_id: question.id).count %>
                                                </small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            <% end %>

                            <div class="page d-flex justify-content-center">
                                <%= paginate @questions_all, param_name: :page_all, params: { tab: "all" } %>
                            </div>
                        </div>
                    </div>

                    <%# ? menエリア %>
                    <div id="men" class="tab-pane">
                        <div class="row question-area">
                            <% @questions_men.each do |question| %>
                                <div class="col-lg-6 mt-4">
                                    <div class="d-flex">
                                        <%= image_tag question.photograph.url, class: "question_image" %>

                                        <div class="question-area">
                                            <div class="d-flex align-items-center user-area">
                                                <%= link_to "/profile/show/#{question.user.id}" do %>
                                                    <% if question.user.avatar.url %>
                                                        <%= image_tag question.user.avatar.url, class: "question-user-image" %>
                                                    <% else %>
                                                        <img src="/assets/user/avatar.png" alt="Generic placeholder image" class="question-user-image">
                                                    <% end %>
                                                <% end %>

                                                <div class="user-information">
                                                    <h5 class="mb-0 fw-bold"><%= question.user.user_name %></h5>
                                                    <small><%= question.created_at.strftime('%m月%d日') %></small>
                                                </div>
                                            </div>

                                            <div class="question-information">
                                                <%= truncate(question.question, length: 44) %>
                                            </div>

                                            <div class="answer d-flex align-items-center justify-content-end">
                                                <%= link_to "/question/show/#{question.id}", style: "text-decoration: none; display: flex; align-items: center; margin-right: 2px;" do %>
                                                    <img src="/assets/icons/icn_message_b.png" alt="">
                                                <% end %>

                                                <small class="m-0">
                                                    <%= Answer.where(question_id: question.id).count %>
                                                </small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            <% end %>

                            <div class="page d-flex justify-content-center">
                                <%= paginate @questions_men, param_name: :page_men, params: { tab: "men" } %>
                            </div>
                        </div>
                    </div>

                    <%# ? womenエリア %>
                    <div id="women" class="tab-pane">
                        <div class="row question-area">
                            <% @questions_women.each do |question| %>
                                <div class="col-lg-6 mt-4">
                                    <div class="d-flex">
                                        <%= image_tag question.photograph.url, class: "question_image" %>

                                        <div class="question-area">
                                            <div class="d-flex align-items-center user-area">
                                                <%= link_to "/profile/show/#{question.user.id}" do %>
                                                    <% if question.user.avatar.url %>
                                                        <%= image_tag question.user.avatar.url, class: "question-user-image" %>
                                                    <% else %>
                                                        <img src="/assets/user/avatar.png" alt="Generic placeholder image" class="question-user-image">
                                                    <% end %>
                                                <% end %>

                                                <div class="user-information">
                                                    <h5 class="mb-0 fw-bold"><%= question.user.user_name %></h5>
                                                    <small><%= question.created_at.strftime('%m月%d日') %></small>
                                                </div>
                                            </div>

                                            <div class="question-information">
                                                <%= truncate(question.question, length: 44) %>
                                            </div>

                                            <div class="answer d-flex align-items-center justify-content-end">
                                                <%= link_to "/question/show/#{question.id}", style: "text-decoration: none; display: flex; align-items: center; margin-right: 2px;" do %>
                                                    <img src="/assets/icons/icn_message_b.png" alt="">
                                                <% end %>

                                                <small class="m-0">
                                                    <%= Answer.where(question_id: question.id).count %>
                                                </small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            <% end %>

                            <div class="page d-flex justify-content-center">
                                <%= paginate @questions_women, param_name: :page_women, params: { tab: "women" } %>
                            </div>
                        </div>
                    </div>
                </div>
            </div>            
        </div>
    </div>
</div>

<script>
  $(document).ready(function() {
        <%# ! 現在位置しているタブをアクティブ状態にする %>
        function setActiveTab(tabId) {
            $('.tab-menu .nav-link').removeClass('active');
            $('.tab-content .tab-pane').removeClass('show active');
            $('#' + tabId).addClass('show active');
            $('.tab-menu .nav-link[href*="tab=' + tabId + '"]').addClass('active');
        }

        const urlParams = new URLSearchParams(window.location.search);
        const tabValue = urlParams.get('tab');

        if (tabValue) {
            const tabId = tabValue.toLowerCase();
            setActiveTab(tabId);
        } else {
            $('.tab-menu .nav-link[href*="?tab=all"]').addClass('active');
            $('.tab-content .tab-pane#all').addClass('show active');
        }

        <%# ! ページ遷移時にタブの位置を保持する %>
        $(document).on('click', '.tab-menu .nav-link', function(event) {
            event.preventDefault();
            const tabId = $(this).attr('href').split('tab=')[1].toLowerCase();

            if (tabId === 'page') {
                return;
            }

            setActiveTab(tabId);

            const newUrl = window.location.pathname + '?tab=' + tabId;
            window.history.pushState({ path: newUrl }, '', newUrl);
        });
  });
</script>